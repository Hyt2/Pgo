var afterservice=afterservice||{};var $container=$(".upload-wrap");var uploader=$(".upload-wrap");var maxPicLimit=3;var uploadSuccess=null;afterservice.insetfileUpload=function(){function init(){uploader.on("click",function(){selectPics(appRoot+"/wap/img/uploadImg.do")});afterservice.delPic()}function selectPics(picServerUrl){try{baseApi.optPictures(picServerUrl,function(picsUrlsOnServer){uploadSuccess(picsUrlsOnServer)})}catch(e){}}uploadSuccess=function(res){try{var imgUrl="<li class='img-item'><img src="+imgUploadDomain+data.ownerId+"_58x58.jpg?v="+initializationTime+"/><a href='javascript:;' class='img-del js-del-img'></a><input type='hidden' name='imgIndex' value='"+data.ownerId+"'/></li>";$(imgUrl).insertBefore($("#add-img-item"))}catch(e){}};init()};afterservice.resetFile=function(){var container=$(".picUpload");var $file=$("#picFileId");if($file.val()!=""){var cfile=$file.clone();$file.remove();container.append(cfile)}};afterservice.mfileUpload=function(){afterservice.uploadImg();afterservice.delPic()};afterservice.upload=function(){afterservice.mfileUpload()};afterservice.delPic=function(){$(".js-dele-imgwrap").live("click",function(){if($(this).parents(".js-img-wrap").eq(0).find(".img-wrap").length<=1){$(this).parents(".js-img-wrap").eq(0).hide();$(".form-textarea").hide().show()}$(this).parents(".img-wrap").eq(0).remove();afterservice.handleImage();var imgLength=$("div[class='img-wrap']").length;if(imgLength<5){$("#imgDomian").children("p").remove();$(".form-textarea").hide().show()}var ownerId=$(this).next().val();probeAuthStatus(function(){$.ajax({cache:false,type:"POST",url:appRoot+"/wap/img/deleteImg.do",data:{ownerId:ownerId},dataType:"json",error:function(request,status,e){console.info("缃戠粶寮傚父,鍒犻櫎澶辫触!")},success:function(data){}})},function(){window.location.href="https://passport.suning.com/ids/login?service="+encodeURIComponent("https://aq.suning.com/asc/auth?targetUrl="+encodeURIComponent(window.location.href))+"&method=GET&loginTheme=wap_new"})})};afterservice.handleImage=function(){var arr_inp=$("input[name='imgIndex']");if(arr_inp&&arr_inp.length>0){var picId="";$(arr_inp).each(function(key,val){picId+=$(this).val();if(key!=arr_inp.length-1){picId+=";"}});$("#picId").val(picId)}else{$("#picId").val("")}};afterservice.uploadImg=function(){var uploader=new plupload.Uploader({file_data_name:"file",runtimes:"html5,html4",browse_button:"js-upload-img",url:appRoot+"/wap/img/uploadImg.do"});uploader.init();uploader.bind("FilesAdded",function(uploader,files){var imgLength=$("div[class='img-wrap']").length;if(imgLength>=5){$("#imgDomian").children("p").remove();$("#imgDomian").append("<p class='error'>闈炲父鎶辨瓑锛屾偍宸蹭笂浼�5寮犵収鐗囷紝鐩墠鏈€澶氬彲涓婁紶5寮犵収鐗囷紒</p>");$(".form-textarea").hide().show();return false}else{$("#imgDomian").children("p").remove();$(".form-textarea").hide().show()}uploader.start()});uploader.bind("FileUploaded",function(uploader,file,responseObject){var data=$.parseJSON(responseObject.response);if(data&&data.ownerId!=""&&data.ownerId!=null){var initializationTime=new Date().getTime();var imgUrl="<div  class='img-wrap'><img src="+imgUploadDomain+data.ownerId+"_58x58.jpg?v="+initializationTime+"/><div class='upload-opts js-active-box'><a href='javascript:void(0)' class='right js-dele-imgwrap'>鍒犻櫎</a><input type='hidden' name='imgIndex' value='"+data.ownerId+"'/></div></div>";if($(".js-img-wrap").find(".img-wrap").length<=0){$(".form-textarea").hide()}$(".js-img-wrap").append(imgUrl).show();$(".form-textarea").show();afterservice.handleImage()}else{alert(data.errorMsg)}});uploader.bind("Error",function(uploader,errObject){alert("绯荤粺绻佸繖锛岃绋嶅悗鍐嶈瘯锛�")})};